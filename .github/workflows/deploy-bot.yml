name: Deploy Bot to Fly.io

on:
  push:
    branches: [main, master, claude/init-project-setup-9CZ8o]
    paths:
      - '*.py'
      - 'cogs/**'
      - 'data/**'
      - 'utils/**'
      - 'views/**'
      - 'modules/**'
      - 'requirements.txt'
      - 'Dockerfile'
      - 'fly.toml'
  workflow_dispatch:

jobs:
  deploy:
    # Pinning ubuntu-22.04 to resolve 'Internal Server Error' / 'Job not acquired' issues with ubuntu-latest
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - uses: superfly/flyctl-actions/setup-flyctl@master

      - run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
