# ATDD Checklist - Epic 5, Story 5.2: Business Logic - Unlock Elder Levels

**Date:** 2026-01-25
**Author:** Zaès (via Antigravity)
**Primary Test Level:** Unit (Business Logic)

---

## Story Summary

**As a** Player
**I want** my available discipline level cap to reflect my Blood Potency (Generation power)
**So that** I can access level 6+ disciplines if my Elder status allows it

---

## Acceptance Criteria

1.  **Given** a character with high Blood Potency (6 to 10)
2.  **When** the `getAvailableDisciplines` function is evaluated
3.  **Then** the `maxAccessibleLevel` property for each discipline should return the correct value (6 to 10)
4.  **And** the returned `powers` array should include powers up to that level
5.  **And** characters with lower Blood Potency (1-5) should still be capped at level 5 or lower (according to existing progression)
6.  **And** fallback safety: invalid/missing Blood Potency should default to safe minimums (Level 1-2)

---

## Failing Tests Created (RED Phase)

> **Note**: This verification was performed retroactively on completed work.

### Unit Tests (Logic)

**File:** `web/src/data/disciplines.test.js`

- ✅ **Test:** `should map BP 6-10 correctly to Levels 6-10`
  - **Status:** GREEN
  - **Verifies:** `MAX_DISCIPLINE_LEVEL` constant mapping.

- ✅ **Test:** `should return clan disciplines with maxLevel cap for BP 10`
  - **Status:** GREEN
  - **Verifies:** `getAvailableDisciplines` logic for Elder BP.

- ✅ **Test:** `should cap maxLevel at 10 for BP > 10 (e.g. Caine)`
  - **Status:** GREEN
  - **Verifies:** Safety cap for super-elders.

- ✅ **Test:** `should default to maxLevel 1 if BP is missing or invalid`
  - **Status:** GREEN
  - **Verifies:** Fallback safety.

---

## Implementation Checklist

### Logic Update
- [x] Update `MAX_DISCIPLINE_LEVEL` logic in `disciplines.js`
- [x] Verify `getAvailableDisciplines` filter logic

### Verification
- [x] Run Unit Tests (`disciplines.test.js`) -> PASS

---

## Running Tests

```bash
# Run logic tests
npm test -- disciplines.test.js
```

---

## Red-Green-Refactor Workflow

### GREEN Phase (Complete) ✅
- Logic verified via unit tests.
- Core business requirement (Unlock Elder Levels) is met in the data layer.

***

**Generated by BMad TEA Agent** - 2026-01-25
